# Comfyui_o1key 更新说明

## 🎉 插件已支持一键自动更新！

从 v1.10.0 版本开始，插件支持自动更新功能。你只需运行更新脚本，即可轻松获取最新版本。

---

## 📦 如何更新

### Windows 用户

1. 打开文件资源管理器
2. 进入插件目录：`ComfyUI\custom_nodes\Comfyui_o1key`
3. 双击运行 `update.bat` 文件
4. 等待更新完成（通常只需几秒钟）
5. 重启 ComfyUI

### Linux/Mac 用户

打开终端，执行以下命令：

```bash
cd ComfyUI/custom_nodes/Comfyui_o1key
chmod +x update.sh  # 首次运行需要添加执行权限
./update.sh
```

---

## ✨ 更新脚本功能

✅ **自动检查更新** - 自动检测是否有新版本  
✅ **备份配置** - 自动备份和恢复 `.config` 配置文件  
✅ **拉取代码** - 自动从 GitHub 拉取最新代码  
✅ **更新依赖** - 自动更新 Python 依赖包  
✅ **显示日志** - 显示最近的更新内容  
✅ **完善提示** - 友好的中文提示和错误处理  

---

## 🔔 更新检查

插件会在每次启动 ComfyUI 时自动检查是否有新版本：

- 如果发现新版本，终端会显示更新提示
- 不会影响插件加载速度
- 不会弹窗打断工作流程
- 检查失败不影响插件正常使用

**终端提示示例：**

```
============================================================
🎉 Comfyui_o1key 有新版本可用 (当前版本: v1.9.1)
============================================================
更新方法：
  Windows: 双击运行 update.bat
  Linux/Mac: 运行 ./update.sh
或手动执行: git pull origin main
============================================================
```

---

## 🛡️ 安全保障

- **配置安全**：更新前自动备份 `.config` 文件，更新后自动恢复
- **环境变量**：存储在系统级别的 API 密钥不受影响
- **错误处理**：更新失败不会破坏现有安装
- **回退方案**：如有问题可用 `git reset` 回退

---

## 🔧 手动更新（备用方案）

如果自动更新脚本无法使用，可以手动执行：

```bash
cd ComfyUI/custom_nodes/Comfyui_o1key
git pull origin main
pip install -r requirements.txt --upgrade
```

---

## ❓ 常见问题

### Q1: 更新会覆盖我的配置吗？

**不会。** 更新脚本会自动备份和恢复你的 `.config` 文件。环境变量中的 API 密钥也不受影响。

### Q2: 更新失败怎么办？

1. 检查网络连接是否正常
2. 确认 Git 已正确安装
3. 尝试手动更新（见上方"手动更新"部分）
4. 如有未提交的修改，先备份后执行 `git reset --hard origin/main`

### Q3: 更新后插件无法启动怎么办？

1. 检查终端错误信息
2. 重新运行依赖安装：`pip install -r requirements.txt --upgrade`
3. 确认 Python 版本 ≥ 3.7
4. 查看 [GitHub Issues](https://github.com/你的用户名/Comfyui_o1key/issues) 寻求帮助

### Q4: 可以禁用启动时的更新检查吗？

暂不支持配置禁用，但更新检查：
- 速度极快（<1 秒）
- 完全静默（无更新时不显示任何信息）
- 失败不影响插件加载

### Q5: 如何查看当前版本？

查看插件目录下的 `version.txt` 文件，或在更新时会显示当前版本号。

### Q6: 多久检查一次更新？

仅在 ComfyUI 启动时检查一次，不会在运行过程中反复检查。

---

## 📮 反馈与支持

如果在更新过程中遇到问题，请：

1. 查看终端输出的错误信息
2. 查阅 [GitHub Issues](https://github.com/你的用户名/Comfyui_o1key/issues)
3. 提交新 Issue 并附上错误信息

---

**享受自动更新带来的便利！** 🎉
