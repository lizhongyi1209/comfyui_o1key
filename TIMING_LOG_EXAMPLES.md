# 耗时日志示例

本文档展示了极简日志格式的输出示例。

## 场景1：文生图（Base64 返回）

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 1张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 45.91s
  ├─ 连接: 0.234s
  └─ 响应: 45.676s (5.12MB)
[3/4] 响应解析 ✓ 0.46s | Base64 3.39MB → 2048x2048
[4/4] 完成！总耗时 46.37s | 成功 1张
```

## 场景2：文生图（URL 返回）

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 1张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 42.77s
  ├─ 连接: 0.198s
  └─ 响应: 42.572s (2.11KB)
[3/4] 响应解析 ✓ 2.23s | URL → 下载 3.45MB (1.63MB/s) → 2048x2048
[4/4] 完成！总耗时 45.00s | 成功 1张
```

## 场景3：图生图（多张输入图像）

```log
Nano Banana Pro: 图生图模式 (输入5张) | 1K 1:1 | 1张
[1/4] 请求构建 ✓ 0.245s | 8.73MB
[2/4] API 请求 ✓ 28.65s
  ├─ 连接: 0.189s
  └─ 响应: 28.461s (1.89KB)
[3/4] 响应解析 ✓ 0.89s | URL → 下载 1.23MB (1.58MB/s) → 1024x1024
[4/4] 完成！总耗时 29.78s | 成功 1张
```

## 场景4：批量生成（单提示词）

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 4张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 45.20s
  ├─ 连接: 0.230s
  └─ 响应: 44.970s (5.10MB)
[3/4] 响应解析 ✓ 0.45s | Base64 3.39MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 46.10s
  ├─ 连接: 0.250s
  └─ 响应: 45.850s (5.20MB)
[3/4] 响应解析 ✓ 0.47s | Base64 3.41MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 44.80s
  ├─ 连接: 0.210s
  └─ 响应: 44.590s (5.00MB)
[3/4] 响应解析 ✓ 0.44s | Base64 3.37MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 45.50s
  ├─ 连接: 0.240s
  └─ 响应: 45.260s (5.10MB)
[3/4] 响应解析 ✓ 0.46s | Base64 3.39MB → 2048x2048
[4/4] 完成！总耗时 47.00s | 成功 4张
```

## 场景5：批量提示词模式

```log
Nano Banana Pro: 批量提示词模式 (3个提示词) | 2K 1:1 | 共6张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 43.50s
  ├─ 连接: 0.220s
  └─ 响应: 43.280s (5.05MB)
[3/4] 响应解析 ✓ 0.45s | Base64 3.38MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 44.20s
  ├─ 连接: 0.230s
  └─ 响应: 43.970s (5.12MB)
[3/4] 响应解析 ✓ 0.46s | Base64 3.40MB → 2048x2048
... (省略中间输出)
[4/4] 完成！总耗时 135.20s | 成功 6张
```

## 场景6：批量任务节点

```log
BatchNanoBananaPro: 批量任务 | 1:1 配对模式 | 共 10 任务
[1/10] [1/4] 请求构建 ✓ 0.15s | 4.20MB
[1/10] [2/4] API 请求 ✓ 38.50s
  ├─ 连接: 0.180s
  └─ 响应: 38.320s (1.90KB)
[1/10] [3/4] 响应解析 ✓ 1.20s | URL → 下载 3.10MB (1.52MB/s) → 2048x2048
[2/10] [1/4] 请求构建 ✓ 0.14s | 4.15MB
[2/10] [2/4] API 请求 ✓ 37.80s
  ├─ 连接: 0.190s
  └─ 响应: 37.610s (2.00KB)
[2/10] [3/4] 响应解析 ✓ 1.30s | URL → 下载 3.25MB (1.60MB/s) → 2048x2048
... (省略中间输出)
[10/10] [3/4] 响应解析 ✓ 1.10s | URL → 下载 3.05MB (1.55MB/s) → 2048x2048
============================================================
完成！总耗时 125.30s | 成功: 10/10 | 生成 10 张
保存路径: D:\output\
```

## 场景7：部分失败

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 4张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 45.20s
  ├─ 连接: 0.230s
  └─ 响应: 44.970s (5.10MB)
[3/4] 响应解析 ✓ 0.45s | Base64 3.39MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 46.10s
  ├─ 连接: 0.250s
  └─ 响应: 45.850s (5.20MB)
[3/4] 响应解析 ✓ 0.47s | Base64 3.41MB → 2048x2048
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 44.80s
  ├─ 连接: 0.210s
  └─ 响应: 44.590s (5.00MB)
[3/4] 响应解析 ✓ 0.44s | Base64 3.37MB → 2048x2048
[4/4] 完成！总耗时 136.50s | 成功 3张 | 失败 1张
```

## 场景8：请求失败（内容审核）

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 1张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
[2/4] API 请求 ✓ 43.50s
  ├─ 连接: 0.220s
  └─ 响应: 43.280s (0.85KB)
Nano Banana Pro: API 错误 - 内容审核拒绝 - candidatesTokenCount = 0

原因：提示词或参考图包含不适当内容（色情、暴力、敏感话题等），在内容审核阶段就被拒绝，连候选内容都未生成。

建议：
  - 检查提示词，确保不包含敏感或违规内容
  - 如使用参考图，确保图片内容健康合规
  - 避免描述暴力、色情等不当内容
  - 调整提示词后重试
```

## 场景9：网络错误

```log
Nano Banana Pro: 文生图模式 | 2K 1:1 | 1张
[1/4] 请求构建 ✓ 0.003s | 0.15MB
Nano Banana Pro: API 错误 - API 请求超时 (504 Gateway Timeout)
API 返回错误：Gateway Timeout

建议：
  - 尝试使用其他模型
  - 稍后重试
  - 降低分辨率或减少输入图像数量
```

## 日志格式说明

### 阶段标识
- `[1/4] 请求构建` - 构造请求体、编码图像
- `[2/4] API 请求` - 发送请求、等待响应（显示连接和响应时间）
- `[3/4] 响应解析` - 解析响应、下载图像（显示格式和尺寸）
- `[4/4] 完成` - 任务完成汇总

### 状态符号
- `✓` - 成功
- `✗` - 失败（仅在错误日志中出现）

### 数据格式
- 时间：< 1s 显示 3 位小数（如 0.234s），≥ 1s 显示 2 位小数（如 45.67s）
- 大小：< 1MB 显示 KB（如 256.45KB），≥ 1MB 显示 MB（如 3.45MB）
- 速度：MB/s（如 1.63MB/s）

### 返回格式标识
- **Base64**: `Base64 [大小] → [尺寸]`
  - 示例：`Base64 3.39MB → 2048x2048`
- **URL**: `URL → 下载 [大小] ([速度]) → [尺寸]`
  - 示例：`URL → 下载 3.45MB (1.63MB/s) → 2048x2048`

## 关键改进

与旧版日志相比，新版日志具有以下优势：

1. **极简首行概览** - 一行即可了解任务类型、参数和数量
2. **删除冗余信息** - 移除 API 端点 URL、超时设置、Base64 预览等
3. **内联格式显示** - 在响应解析阶段直接显示 Base64/URL 格式
4. **统一符号系统** - 使用 `✓` 表示成功，保持简洁
5. **精简阶段输出** - 减少表情符号和多余的文字描述
6. **智能时间格式** - 根据时长自动调整精度

## 耗时分析

从日志可以清晰看出：

1. **请求构建阶段** - 通常 < 1秒（文生图）或几百毫秒（图生图因需编码图像）
2. **API 请求阶段** - 主要瓶颈，占总时间 90%+
   - 连接时间：通常 0.2-0.3s
   - 响应时间：包含服务器处理和数据传输，是主要耗时
3. **响应解析阶段** - URL 模式需要下载，比 Base64 模式稍慢
4. **总耗时** - 单张图像通常 40-50 秒

## 故障诊断

- **连接时间过长（> 1s）**: 网络问题或 DNS 解析慢
- **响应时间过长（> 60s）**: 服务器负载高或网络传输慢
- **下载速度过慢（< 1MB/s）**: 网络带宽不足
- **响应体过小（< 1KB）且失败**: 通常是内容审核拒绝
